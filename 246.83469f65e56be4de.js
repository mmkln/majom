"use strict";(self.webpackChunkplatform_frontend=self.webpackChunkplatform_frontend||[]).push([[246],{4246:(Tt,A,m)=>{m.r(A),m.d(A,{KanbanModule:()=>bt});var T=m(1368),V=m(5132),E=m(6716),s=m(4496),Z=m(7048);let _=(()=>{class e{constructor(t){this.http=t}updateTask(t){return this.http.put(`${E.O.apiUrl}/tasks/${t.id}/`,t,{headers:{}})}getTasks(){return this.http.get(`${E.O.apiUrl}/tasks`,{headers:{}})}static#t=this.\u0275fac=function(n){return new(n||e)(s.CoB(Z.KK))};static#e=this.\u0275prov=s.wxM({token:e,factory:e.\u0275fac})}return e})();var P=m(2531),L=m(1528),q=m(9336),y=m(5084),b=m(9212),p=m(4940);let d;const R=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&R.decode();let w=null;function K(){return(null===w||0===w.byteLength)&&(w=new Uint8Array(d.memory.buffer)),w}function F(e,a){return e>>>=0,R.decode(K().subarray(e,e+a))}const h=new Array(128).fill(void 0);h.push(void 0,null,!0,!1);let v=h.length;function $(e){v===h.length&&h.push(h.length+1);const a=v;return v=h[a],h[a]=e,a}function D(e){return h[e]}let O=0;const U=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},nt="function"==typeof U.encodeInto?function(e,a){return U.encodeInto(e,a)}:function(e,a){const t=U.encode(e);return a.set(t),{read:e.length,written:t.length}};function B(e,a,t){if(void 0===t){const c=U.encode(e),l=a(c.length,1)>>>0;return K().subarray(l,l+c.length).set(c),O=c.length,l}let n=e.length,o=a(n,1)>>>0;const r=K();let i=0;for(;i<n;i++){const c=e.charCodeAt(i);if(c>127)break;r[o+i]=c}if(i!==n){0!==i&&(e=e.slice(i)),o=t(o,n,n=i+3*e.length,1)>>>0;const c=K().subarray(o+i,o+n);i+=nt(e,c).written,o=t(o,n,i,1)>>>0}return O=i,o}let C=null;function H(){return(null===C||0===C.byteLength)&&(C=new Int32Array(d.memory.buffer)),C}function I(){return(I=(0,L.c)(function*(e,a){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return yield WebAssembly.instantiateStreaming(e,a)}catch(n){if("application/wasm"==e.headers.get("Content-Type"))throw n;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n)}const t=yield e.arrayBuffer();return yield WebAssembly.instantiate(t,a)}{const t=yield WebAssembly.instantiate(e,a);return t instanceof WebAssembly.Instance?{instance:t,module:e}:t}})).apply(this,arguments)}function Y(){const e={wbg:{}};return e.wbg.__wbindgen_string_new=function(a,t){return $(F(a,t))},e.wbg.__wbindgen_object_drop_ref=function(a){!function et(e){const a=D(e);return function tt(e){e<132||(h[e]=v,v=e)}(e),a}(a)},e.wbg.__wbg_log_5bb5f88f245d7762=function(a){console.log(D(a))},e.wbg.__wbg_log_1746d5c75ec89963=function(a,t){console.log(D(a),D(t))},e.wbg.__wbg_getTime_2bc4375165f02d15=function(a){return D(a).getTime()},e.wbg.__wbg_new0_7d84e5b2cd9fdc73=function(){return $(new Date)},e.wbg.__wbindgen_throw=function(a,t){throw new Error(F(a,t))},e}function J(e){return W.apply(this,arguments)}function W(){return W=(0,L.c)(function*(e){if(void 0!==d)return d;typeof e>"u"&&(e=new URL("assign_kanban_tasks_bg.wasm","file:///Users/michamoll/Desktop/platform/platform-frontend/src/assets/wasm/assign_kanban_tasks.js"));const a=Y();("string"==typeof e||"function"==typeof Request&&e instanceof Request||"function"==typeof URL&&e instanceof URL)&&(e=fetch(e));const{instance:t,module:n}=yield function ot(e,a){return I.apply(this,arguments)}(yield e,a);return function N(e,a){return d=e.exports,J.__wbindgen_wasm_module=a,C=null,w=null,d}(t,n)}),W.apply(this,arguments)}const at=J;function G(e){const a=new Date(e),t=new Date;return t.setHours(0,0,0,0),a.setHours(0,0,0,0),a.getDate()===t.getDate()&&a.getMonth()===t.getMonth()&&a.getFullYear()===t.getFullYear()}function j(e){const a=new Date(e),t=new Date;return t.setDate(t.getDate()+1),t.setHours(0,0,0,0),a.setHours(0,0,0,0),a.getDate()===t.getDate()&&a.getMonth()===t.getMonth()&&a.getFullYear()===t.getFullYear()}function Q(e,a,t){const n=new Date(e),o=new Date(n.getFullYear(),n.getMonth(),n.getDate()),r=new Date,i=new Date(r.getFullYear(),r.getMonth(),r.getDate()),c=new Date(i);c.setDate(i.getDate()+a);const l=new Date(i);return l.setDate(i.getDate()+t),o>=c&&o<=l}var u=function(e){return e.Today="today",e.Tomorrow="tomorrow",e.Soon="soon",e.Planned="planned",e.Todo="todo",e.Done="done",e.Cancelled="cancelled",e}(u||{});const z=[{title:u.Today,tasks:[],events:[],habits:[]},{title:u.Tomorrow,tasks:[],events:[],habits:[]},{title:u.Soon,tasks:[],events:[],habits:[]},{title:u.Planned,tasks:[],events:[],habits:[]},{title:u.Todo,tasks:[],events:[],habits:[]},{title:u.Done,tasks:[],events:[],habits:[]},{title:u.Cancelled,tasks:[],events:[],habits:[]}];var x=m(5312),X=m(1308),S=m(6844);function it(e,a){if(1&e){const t=s.KQA();s.I0R(0,"div",2)(1,"xx-column",3),s.qCj("onTaskUpdate",function(o){s.usT(t);const r=s.GaO();return s.CGJ(r.onTaskUpdate(o))})("onHabitUpdate",function(o){s.usT(t);const r=s.GaO();return s.CGJ(r.onHabitUpdate(o))}),s.C$Y()()}if(2&e){const t=a.$implicit;s.yG2(),s.E7m("column",t)}}let rt=(()=>{class e{constructor(t,n,o){this.apiService=t,this.pageTitleService=n,this.habitsApiService=o,this.columnList=JSON.parse(JSON.stringify(z)),this.columnTitles=Object.values(u),this.taskList=[],this.habitList=[]}ngOnInit(){this.pageTitleService.setPageTitle("kanban"),this.fetchData()}fetchData(){(0,q.y)({tasks:this.apiService.getTasks().pipe((0,y.K)()),habits:this.habitsApiService.getHabits().pipe((0,y.K)())}).pipe((0,b.y)(({tasks:t,habits:n})=>{this.taskList=t,this.habitList=n,this.updateColumns()})).subscribe()}updateColumns(){const t=this.assignTasksToColumns(this.taskList,this.columnTitles);this.columnList=this.assignHabitsToColumns(t)}updateCollumns(){var t=this;return(0,L.c)(function*(){yield at("/assets/wasm/assign_kanban_tasks_bg.wasm"),console.log("Before calling assign_tasks_to_columns");const n=t.taskList,o=t.columnTitles;console.log("Tasks:",n),console.log("ColumnTitles:",o);try{const r=JSON.stringify(n),i=JSON.stringify(o);console.log("After stringify");const c=function st(e,a){let t,n;try{const i=d.__wbindgen_add_to_stack_pointer(-16),c=B(e,d.__wbindgen_malloc,d.__wbindgen_realloc),l=O,f=B(a,d.__wbindgen_malloc,d.__wbindgen_realloc);d.assign_tasks_to_columns(i,c,l,f,O);var o=H()[i/4+0],r=H()[i/4+1];return t=o,n=r,F(o,r)}finally{d.__wbindgen_add_to_stack_pointer(16),d.__wbindgen_free(t,n,1)}}(r,i);console.log("After calling assign_tasks_to_columns"),console.log("Columns:",c);const l=JSON.parse(c);t.columnList=t.assignHabitsToColumns(l)}catch(r){console.error("Error calling assign_tasks_to_columns:",r)}})()}assignHabitsToColumns(t){const n=[...t],o=this.habitList.filter(r=>r.status===p.sD.Active);return[u.Today].forEach(r=>{const i=n.find(c=>c.title===r);i&&(i.habits=o)}),n}assignTasksToColumns(t,n){let o=JSON.parse(JSON.stringify(z));return console.log({columns:o}),t.forEach(r=>{let i=null;if(r.due_date&&G(r.due_date)&&(i=u.Today),i||(i={[p.sD.Completed]:u.Done,[p.sD.Cancelled]:u.Cancelled}[r.status]||null),!i&&r.due_date&&(i=this.categorizeDueDate(r.due_date)),i||(i={[p.sD.Active]:u.Todo,[p.sD.Draft]:u.Todo,[p.sD.Described]:u.Todo}[r.status]||null),i){if(i!==u.Today&&i!==u.Tomorrow&&null!==r.challenge)return;const l=o.find(f=>f.title===i);l&&i===u.Today&&r.is_completed?l.tasks.push(r):l&&l.tasks.unshift(r)}}),o}categorizeDueDate(t){return t?G(t)?u.Today:j(t)?u.Tomorrow:Q(t,2,5)?u.Soon:u.Planned:null}onTaskUpdate(t){this.fetchData()}onHabitUpdate(t){this.fetchData()}static#t=this.\u0275fac=function(n){return new(n||e)(s.GI1(_),s.GI1(x.M$),s.GI1(X.H))};static#e=this.\u0275cmp=s.In1({type:e,selectors:[["xx-kanban"]],decls:2,vars:1,consts:[[1,"flex","h-full"],["class","mr-3 w-[17.5rem]","aria-label","Column",4,"ngFor","ngForOf"],["aria-label","Column",1,"mr-3","w-[17.5rem]"],[3,"column","onTaskUpdate","onHabitUpdate"]],template:function(n,o){1&n&&(s.I0R(0,"div",0),s.yuY(1,it,2,1,"div",1),s.C$Y()),2&n&&(s.yG2(),s.E7m("ngForOf",o.columnList))},dependencies:[T.ay,S.O]})}return e})();var M=m(5291);function ct(e,a){if(1&e){const t=s.KQA();s.I0R(0,"div",2)(1,"xx-column",3),s.qCj("onTaskUpdate",function(o){s.usT(t);const r=s.GaO();return s.CGJ(r.onTaskUpdate(o))}),s.C$Y()()}if(2&e){const t=a.$implicit;s.yG2(),s.E7m("sortByPriority",!0)("column",t)}}let lt=(()=>{class e{constructor(t,n){this.apiService=t,this.pageTitleService=n,this.columnList=[],this.taskList=[]}ngOnInit(){this.pageTitleService.setPageTitle("Kanban week"),this.getTasks()}getTasks(){this.apiService.getTasks().pipe((0,y.K)(),(0,b.y)(t=>{this.taskList=t,this.columnList=this.sortTasksForWeek(this.taskList)})).subscribe()}sortTasksForWeek(t){const n=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],o=n.map(c=>(0,M.m)(c)),{start:r,end:i}=this.getCurrentWeekRange();return t.forEach(c=>{let l=c.start_date||c.due_date;if(l&&(l=new Date(l),this.isDateWithinWeek(l,r,i))){const f=n[l.getDay()];o.find(g=>g.title===f)?.tasks.push(c)}}),o}getCurrentWeekRange(){const t=new Date,n=t.getDay(),o=new Date(t);o.setDate(t.getDate()-n),o.setHours(0,0,0,0);const r=new Date(o);return r.setDate(o.getDate()+6),r.setHours(23,59,59,999),{start:o,end:r}}isDateWithinWeek(t,n,o){return t>=n&&t<=o}onTaskUpdate(t){this.apiService.updateTask(t).pipe((0,y.K)(),(0,b.y)(n=>{this.getTasks()})).subscribe()}static#t=this.\u0275fac=function(n){return new(n||e)(s.GI1(_),s.GI1(x.M$))};static#e=this.\u0275cmp=s.In1({type:e,selectors:[["xx-kanban-week"]],decls:2,vars:1,consts:[[1,"flex","h-full"],["class","mr-3 w-[17.5rem]","aria-label","Column",4,"ngFor","ngForOf"],["aria-label","Column",1,"mr-3","w-[17.5rem]"],[3,"sortByPriority","column","onTaskUpdate"]],template:function(n,o){1&n&&(s.I0R(0,"div",0),s.yuY(1,ct,2,2,"div",1),s.C$Y()),2&n&&(s.yG2(),s.E7m("ngForOf",o.columnList))},dependencies:[T.ay,S.O]})}return e})();function ut(e,a){if(1&e){const t=s.KQA();s.I0R(0,"div",2)(1,"xx-column",3),s.qCj("onTaskUpdate",function(o){s.usT(t);const r=s.GaO();return s.CGJ(r.onTaskUpdate(o))}),s.C$Y()()}if(2&e){const t=a.$implicit;s.yG2(),s.E7m("column",t)("sortByPriority",!0)}}let mt=(()=>{class e{constructor(t,n){this.apiService=t,this.pageTitleService=n,this.columnList=[],this.taskList=[]}ngOnInit(){this.pageTitleService.setPageTitle("Kanban week upcoming"),this.getTasks()}getTasks(){this.apiService.getTasks().pipe((0,y.K)(),(0,b.y)(t=>{this.taskList=t,this.columnList=this.sortTasksForUpcomingWeek(this.taskList)})).subscribe()}sortTasksForUpcomingWeek(t){const{start:n,end:o}=this.getUpcomingWeekRange(),i=Array.from({length:7}).map((c,l)=>{const f=new Date(n);return f.setDate(n.getDate()+l),f.toLocaleDateString("en-US",{weekday:"long"})}).map(c=>({title:c,tasks:[],events:[],habits:[]}));return t.forEach(c=>{let l=c.start_date||c.due_date;if(l&&(l=new Date(l),l>=n&&l<=o)){const f=l.toLocaleDateString("en-US",{weekday:"long"});i.find(g=>g.title===f)?.tasks.push(c)}}),i}getUpcomingWeekRange(){const t=new Date;t.setHours(0,0,0,0);const n=new Date(t);return n.setDate(t.getDate()+6),n.setHours(23,59,59,999),{start:t,end:n}}isDateWithinWeek(t,n,o){return t>=n&&t<=o}onTaskUpdate(t){this.apiService.updateTask(t).pipe((0,y.K)(),(0,b.y)(n=>{this.getTasks()})).subscribe()}static#t=this.\u0275fac=function(n){return new(n||e)(s.GI1(_),s.GI1(x.M$))};static#e=this.\u0275cmp=s.In1({type:e,selectors:[["xx-kanban-week-upcoming"]],decls:2,vars:1,consts:[[1,"flex","h-full"],["class","mr-3 w-[17.5rem]","aria-label","Column",4,"ngFor","ngForOf"],["aria-label","Column",1,"mr-3","w-[17.5rem]"],[3,"column","sortByPriority","onTaskUpdate"]],template:function(n,o){1&n&&(s.I0R(0,"div",0),s.yuY(1,ut,2,2,"div",1),s.C$Y()),2&n&&(s.yG2(),s.E7m("ngForOf",o.columnList))},dependencies:[T.ay,S.O]})}return e})();function dt(e,a){if(1&e){const t=s.KQA();s.I0R(0,"div",2)(1,"xx-column",3),s.qCj("onTaskUpdate",function(o){s.usT(t);const r=s.GaO();return s.CGJ(r.onTaskUpdate(o))}),s.C$Y()()}if(2&e){const t=a.$implicit;s.yG2(),s.E7m("column",t)}}let ft=(()=>{class e{constructor(t,n){this.apiService=t,this.pageTitleService=n,this.columnList=[],this.columnTitles=Object.values(p.WK).reverse(),this.taskList=[]}ngOnInit(){this.getTasks(),this.pageTitleService.setPageTitle("Kanban by Priority")}getTasks(){this.apiService.getTasks().pipe((0,y.K)(),(0,b.y)(t=>{this.taskList=this.filterOutChallengeTasks(t),this.columnList=this.sortTasksByPriorityAndStatus(this.taskList,this.columnTitles)})).subscribe()}filterOutChallengeTasks(t){return t.filter(n=>!n.challenge)}sortTasksByPriorityAndStatus(t,n){const o=n.map(r=>(0,M.m)(r));return t.forEach(r=>{const i=o.find(c=>c.title.toLowerCase()===r.priority);i&&i.tasks.push(r)}),o.forEach(r=>{r.tasks.sort((i,c)=>i.status.localeCompare(c.status))}),o}onTaskUpdate(t){this.getTasks()}static#t=this.\u0275fac=function(n){return new(n||e)(s.GI1(_),s.GI1(x.M$))};static#e=this.\u0275cmp=s.In1({type:e,selectors:[["xx-kanban-by-priority"]],decls:2,vars:1,consts:[[1,"flex","h-full"],["class","mr-3 w-[17.5rem]","aria-label","Column",4,"ngFor","ngForOf"],["aria-label","Column",1,"mr-3","w-[17.5rem]"],[3,"column","onTaskUpdate"]],template:function(n,o){1&n&&(s.I0R(0,"div",0),s.yuY(1,dt,2,1,"div",1),s.C$Y()),2&n&&(s.yG2(),s.E7m("ngForOf",o.columnList))},dependencies:[T.ay,S.O]})}return e})();var pt=m(6724);function ht(e,a){if(1&e){const t=s.KQA();s.I0R(0,"div",2)(1,"xx-column",3),s.qCj("onTaskUpdate",function(o){s.usT(t);const r=s.GaO();return s.CGJ(r.onTaskUpdate(o))}),s.C$Y()()}if(2&e){const t=a.$implicit;s.yG2(),s.E7m("column",t)}}const gt=[{path:"",component:rt},{path:"week",component:lt},{path:"week-upcoming",component:mt},{path:"by-priority",component:ft},{path:"by-priority-2",component:(()=>{class e{constructor(t,n){this.apiService=t,this.pageTitleService=n,this.columnList=[],this.columnTitles=["First","Next","Soon","Planned","Draft","Done","Cancelled"],this.taskList=[]}ngOnInit(){this.getTasks(),this.pageTitleService.setPageTitle("Kanban by Priority 2")}getTasks(){this.apiService.getTasks().pipe((0,y.K)(),(0,b.y)(t=>{this.taskList=t.filter(n=>!n.challenge),this.columnList=this.sortTasksByPriority(this.taskList,this.columnTitles)})).subscribe()}sortTasksByPriority(t,n){const o=n.map(i=>(0,M.m)(i));return(0,pt.ek)(t,"asc").forEach(i=>{let c=this.mapStatusToColumnKey(i.status);if(c||(c=this.mapDueDateToColumnKey(i.due_date)),c){const l=o.find(f=>f.title===c);l&&l.tasks.push(i)}else{const l=o.find(g=>"First"===g.title),f=o.find(g=>"Next"===g.title),k=o.find(g=>"Soon"===g.title);l&&l.tasks.length<10?l.tasks.push(i):f&&f.tasks.length<10?f.tasks.push(i):k&&k.tasks.push(i)}}),o}mapStatusToColumnKey(t){return{[p.sD.Completed]:"Done",[p.sD.Cancelled]:"Cancelled",[p.sD.Draft]:"Draft"}[t]||null}mapDueDateToColumnKey(t){return t?this.categorizeDueDate(t):null}categorizeDueDate(t){return t?G(t)?"First":j(t)?"Next":Q(t,2,5)?"Soon":"Planned":null}onTaskUpdate(t){this.getTasks()}static#t=this.\u0275fac=function(n){return new(n||e)(s.GI1(_),s.GI1(x.M$))};static#e=this.\u0275cmp=s.In1({type:e,selectors:[["xx-kanban-by-priority-2"]],decls:2,vars:1,consts:[[1,"flex","h-full"],["class","mr-3 w-[17.5rem]","aria-label","Column",4,"ngFor","ngForOf"],["aria-label","Column",1,"mr-3","w-[17.5rem]"],[3,"column","onTaskUpdate"]],template:function(n,o){1&n&&(s.I0R(0,"div",0),s.yuY(1,ht,2,1,"div",1),s.C$Y()),2&n&&(s.yG2(),s.E7m("ngForOf",o.columnList))},dependencies:[T.ay,S.O]})}return e})()},{path:"**",redirectTo:"/kanban",pathMatch:"full"}];let yt=(()=>{class e{static#t=this.\u0275fac=function(n){return new(n||e)};static#e=this.\u0275mod=s.a4G({type:e});static#n=this.\u0275inj=s.s3X({imports:[P.qQ.forChild(gt),P.qQ]})}return e})(),bt=(()=>{class e{static#t=this.\u0275fac=function(n){return new(n||e)};static#e=this.\u0275mod=s.a4G({type:e});static#n=this.\u0275inj=s.s3X({providers:[_,X.H],imports:[T.MD,yt,V.k]})}return e})()}}]);