"use strict";(self.webpackChunkplatform_frontend=self.webpackChunkplatform_frontend||[]).push([[246],{4246:(wt,E,m)=>{m.r(E),m.d(E,{KanbanModule:()=>vt});var T=m(1368),Z=m(9280),A=m(6716),s=m(4496),q=m(7048);let k=(()=>{class e{constructor(t){this.http=t}updateTask(t){return this.http.put(`${A.O.apiUrl}/tasks/${t.id}/`,t,{headers:{}})}getTasks(){return this.http.get(`${A.O.apiUrl}/tasks`,{headers:{}})}static#t=this.\u0275fac=function(n){return new(n||e)(s.CoB(q.KK))};static#e=this.\u0275prov=s.wxM({token:e,factory:e.\u0275fac})}return e})();var P=m(2531),L=m(1528),tt=m(3616),et=m(6684),y=m(9212),nt=m(9336),b=m(5084),R=m(3480),p=m(4940);let d;const $=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&$.decode();let v=null;function U(){return(null===v||0===v.byteLength)&&(v=new Uint8Array(d.memory.buffer)),v}function F(e,o){return e>>>=0,$.decode(U().subarray(e,e+o))}const h=new Array(128).fill(void 0);h.push(void 0,null,!0,!1);let w=h.length;function B(e){w===h.length&&h.push(h.length+1);const o=w;return w=h[o],h[o]=e,o}function D(e){return h[e]}let K=0;const O=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},ot="function"==typeof O.encodeInto?function(e,o){return O.encodeInto(e,o)}:function(e,o){const t=O.encode(e);return o.set(t),{read:e.length,written:t.length}};function H(e,o,t){if(void 0===t){const c=O.encode(e),l=o(c.length,1)>>>0;return U().subarray(l,l+c.length).set(c),K=c.length,l}let n=e.length,a=o(n,1)>>>0;const r=U();let i=0;for(;i<n;i++){const c=e.charCodeAt(i);if(c>127)break;r[a+i]=c}if(i!==n){0!==i&&(e=e.slice(i)),a=t(a,n,n=i+3*e.length,1)>>>0;const c=U().subarray(a+i,a+n);i+=ot(e,c).written,a=t(a,n,i,1)>>>0}return K=i,a}let C=null;function Y(){return(null===C||0===C.byteLength)&&(C=new Int32Array(d.memory.buffer)),C}function I(){return(I=(0,L.c)(function*(e,o){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return yield WebAssembly.instantiateStreaming(e,o)}catch(n){if("application/wasm"==e.headers.get("Content-Type"))throw n;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n)}const t=yield e.arrayBuffer();return yield WebAssembly.instantiate(t,o)}{const t=yield WebAssembly.instantiate(e,o);return t instanceof WebAssembly.Instance?{instance:t,module:e}:t}})).apply(this,arguments)}function N(){const e={wbg:{}};return e.wbg.__wbindgen_string_new=function(o,t){return B(F(o,t))},e.wbg.__wbindgen_object_drop_ref=function(o){!function at(e){const o=D(e);return function st(e){e<132||(h[e]=w,w=e)}(e),o}(o)},e.wbg.__wbg_log_5bb5f88f245d7762=function(o){console.log(D(o))},e.wbg.__wbg_log_1746d5c75ec89963=function(o,t){console.log(D(o),D(t))},e.wbg.__wbg_getTime_2bc4375165f02d15=function(o){return D(o).getTime()},e.wbg.__wbg_new0_7d84e5b2cd9fdc73=function(){return B(new Date)},e.wbg.__wbindgen_throw=function(o,t){throw new Error(F(o,t))},e}function j(e){return W.apply(this,arguments)}function W(){return W=(0,L.c)(function*(e){if(void 0!==d)return d;typeof e>"u"&&(e=new URL("assign_kanban_tasks_bg.wasm","file:///Users/michamoll/Desktop/platform/platform-frontend/src/assets/wasm/assign_kanban_tasks.js"));const o=N();("string"==typeof e||"function"==typeof Request&&e instanceof Request||"function"==typeof URL&&e instanceof URL)&&(e=fetch(e));const{instance:t,module:n}=yield function rt(e,o){return I.apply(this,arguments)}(yield e,o);return function J(e,o){return d=e.exports,j.__wbindgen_wasm_module=o,C=null,v=null,d}(t,n)}),W.apply(this,arguments)}const ct=j;function G(e){const o=new Date(e),t=new Date;return t.setHours(0,0,0,0),o.setHours(0,0,0,0),o.getDate()===t.getDate()&&o.getMonth()===t.getMonth()&&o.getFullYear()===t.getFullYear()}function Q(e){const o=new Date(e),t=new Date;return t.setDate(t.getDate()+1),t.setHours(0,0,0,0),o.setHours(0,0,0,0),o.getDate()===t.getDate()&&o.getMonth()===t.getMonth()&&o.getFullYear()===t.getFullYear()}function z(e,o,t){const n=new Date(e),a=new Date(n.getFullYear(),n.getMonth(),n.getDate()),r=new Date,i=new Date(r.getFullYear(),r.getMonth(),r.getDate()),c=new Date(i);c.setDate(i.getDate()+o);const l=new Date(i);return l.setDate(i.getDate()+t),a>=c&&a<=l}var u=function(e){return e.Today="today",e.Tomorrow="tomorrow",e.Soon="soon",e.Planned="planned",e.Todo="todo",e.Done="done",e.Cancelled="cancelled",e}(u||{});const X=[{title:u.Today,tasks:[],events:[],habits:[]},{title:u.Tomorrow,tasks:[],events:[],habits:[]},{title:u.Soon,tasks:[],events:[],habits:[]},{title:u.Planned,tasks:[],events:[],habits:[]},{title:u.Todo,tasks:[],events:[],habits:[]},{title:u.Done,tasks:[],events:[],habits:[]},{title:u.Cancelled,tasks:[],events:[],habits:[]}];var S=m(5312),V=m(1308),lt=m(2640),x=m(6844);function ut(e,o){if(1&e){const t=s.KQA();s.I0R(0,"div",2)(1,"xx-column",3),s.qCj("onTaskUpdate",function(a){s.usT(t);const r=s.GaO();return s.CGJ(r.onTaskUpdate(a))})("onHabitUpdate",function(a){s.usT(t);const r=s.GaO();return s.CGJ(r.onHabitUpdate(a))}),s.C$Y()()}if(2&e){const t=o.$implicit;s.yG2(),s.E7m("column",t)}}let mt=(()=>{class e{constructor(t,n,a,r){this.apiService=t,this.pageTitleService=n,this.habitsApiService=a,this.createEntityWidgetService=r,this.columnList=JSON.parse(JSON.stringify(X)),this.columnTitles=Object.values(u),this.taskList=[],this.habitList=[],this.destroy$=(0,s.uUt)(R.UF)}ngOnInit(){this.pageTitleService.setPageTitle("kanban"),this.fetchData(),this.createEntityWidgetService.taskCreatedTrigger.pipe((0,tt.a)(this.destroy$),(0,et.I)(t=>t),(0,y.y)(t=>{this.fetchData()})).subscribe()}fetchData(){(0,nt.y)({tasks:this.apiService.getTasks().pipe((0,b.K)()),habits:this.habitsApiService.getHabits().pipe((0,b.K)())}).pipe((0,y.y)(({tasks:t,habits:n})=>{this.taskList=t,this.habitList=n,this.updateColumns()})).subscribe()}updateColumns(){const t=this.assignTasksToColumns(this.taskList,this.columnTitles);this.columnList=this.assignHabitsToColumns(t)}updateCollumns(){var t=this;return(0,L.c)(function*(){yield ct("/assets/wasm/assign_kanban_tasks_bg.wasm"),console.log("Before calling assign_tasks_to_columns");const n=t.taskList,a=t.columnTitles;console.log("Tasks:",n),console.log("ColumnTitles:",a);try{const r=JSON.stringify(n),i=JSON.stringify(a);console.log("After stringify");const c=function it(e,o){let t,n;try{const i=d.__wbindgen_add_to_stack_pointer(-16),c=H(e,d.__wbindgen_malloc,d.__wbindgen_realloc),l=K,f=H(o,d.__wbindgen_malloc,d.__wbindgen_realloc);d.assign_tasks_to_columns(i,c,l,f,K);var a=Y()[i/4+0],r=Y()[i/4+1];return t=a,n=r,F(a,r)}finally{d.__wbindgen_add_to_stack_pointer(16),d.__wbindgen_free(t,n,1)}}(r,i);console.log("After calling assign_tasks_to_columns"),console.log("Columns:",c);const l=JSON.parse(c);t.columnList=t.assignHabitsToColumns(l)}catch(r){console.error("Error calling assign_tasks_to_columns:",r)}})()}assignHabitsToColumns(t){const n=[...t],a=this.habitList.filter(r=>r.status===p.sD.Active);return[u.Today].forEach(r=>{const i=n.find(c=>c.title===r);i&&(i.habits=a)}),n}assignTasksToColumns(t,n){let a=JSON.parse(JSON.stringify(X));return t.forEach(r=>{let i=null;if(r.due_date&&G(r.due_date)&&(i=u.Today),i||(i={[p.sD.Completed]:u.Done,[p.sD.Cancelled]:u.Cancelled}[r.status]||null),!i&&r.due_date&&(i=this.categorizeDueDate(r.due_date)),i||(i={[p.sD.Active]:u.Todo,[p.sD.Draft]:u.Todo,[p.sD.Described]:u.Todo}[r.status]||null),i){if(i!==u.Today&&i!==u.Tomorrow&&null!==r.challenge)return;const l=a.find(f=>f.title===i);l&&i===u.Today&&r.is_completed?l.tasks.push(r):l&&l.tasks.unshift(r)}}),a}categorizeDueDate(t){return t?G(t)?u.Today:Q(t)?u.Tomorrow:z(t,2,5)?u.Soon:u.Planned:null}onTaskUpdate(t){this.fetchData()}onHabitUpdate(t){this.fetchData()}static#t=this.\u0275fac=function(n){return new(n||e)(s.GI1(k),s.GI1(S.M$),s.GI1(V.H),s.GI1(lt.s))};static#e=this.\u0275cmp=s.In1({type:e,selectors:[["xx-kanban"]],features:[s.M5G([R.UF])],decls:2,vars:1,consts:[[1,"flex","h-full"],["class","mr-3 w-[17.5rem]","aria-label","Column",4,"ngFor","ngForOf"],["aria-label","Column",1,"mr-3","w-[17.5rem]"],[3,"column","onTaskUpdate","onHabitUpdate"]],template:function(n,a){1&n&&(s.I0R(0,"div",0),s.yuY(1,ut,2,1,"div",1),s.C$Y()),2&n&&(s.yG2(),s.E7m("ngForOf",a.columnList))},dependencies:[T.ay,x.O]})}return e})();var M=m(5291);function dt(e,o){if(1&e){const t=s.KQA();s.I0R(0,"div",2)(1,"xx-column",3),s.qCj("onTaskUpdate",function(a){s.usT(t);const r=s.GaO();return s.CGJ(r.onTaskUpdate(a))}),s.C$Y()()}if(2&e){const t=o.$implicit;s.yG2(),s.E7m("sortByPriority",!0)("column",t)}}let ft=(()=>{class e{constructor(t,n){this.apiService=t,this.pageTitleService=n,this.columnList=[],this.taskList=[]}ngOnInit(){this.pageTitleService.setPageTitle("Kanban week"),this.getTasks()}getTasks(){this.apiService.getTasks().pipe((0,b.K)(),(0,y.y)(t=>{this.taskList=t,this.columnList=this.sortTasksForWeek(this.taskList)})).subscribe()}sortTasksForWeek(t){const n=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],a=n.map(c=>(0,M.m)(c)),{start:r,end:i}=this.getCurrentWeekRange();return t.forEach(c=>{let l=c.start_date||c.due_date;if(l&&(l=new Date(l),this.isDateWithinWeek(l,r,i))){const f=n[l.getDay()];a.find(g=>g.title===f)?.tasks.push(c)}}),a}getCurrentWeekRange(){const t=new Date,n=t.getDay(),a=new Date(t);a.setDate(t.getDate()-n),a.setHours(0,0,0,0);const r=new Date(a);return r.setDate(a.getDate()+6),r.setHours(23,59,59,999),{start:a,end:r}}isDateWithinWeek(t,n,a){return t>=n&&t<=a}onTaskUpdate(t){this.apiService.updateTask(t).pipe((0,b.K)(),(0,y.y)(n=>{this.getTasks()})).subscribe()}static#t=this.\u0275fac=function(n){return new(n||e)(s.GI1(k),s.GI1(S.M$))};static#e=this.\u0275cmp=s.In1({type:e,selectors:[["xx-kanban-week"]],decls:2,vars:1,consts:[[1,"flex","h-full"],["class","mr-3 w-[17.5rem]","aria-label","Column",4,"ngFor","ngForOf"],["aria-label","Column",1,"mr-3","w-[17.5rem]"],[3,"sortByPriority","column","onTaskUpdate"]],template:function(n,a){1&n&&(s.I0R(0,"div",0),s.yuY(1,dt,2,2,"div",1),s.C$Y()),2&n&&(s.yG2(),s.E7m("ngForOf",a.columnList))},dependencies:[T.ay,x.O]})}return e})();function pt(e,o){if(1&e){const t=s.KQA();s.I0R(0,"div",2)(1,"xx-column",3),s.qCj("onTaskUpdate",function(a){s.usT(t);const r=s.GaO();return s.CGJ(r.onTaskUpdate(a))}),s.C$Y()()}if(2&e){const t=o.$implicit;s.yG2(),s.E7m("column",t)("sortByPriority",!0)}}let ht=(()=>{class e{constructor(t,n){this.apiService=t,this.pageTitleService=n,this.columnList=[],this.taskList=[]}ngOnInit(){this.pageTitleService.setPageTitle("Kanban week upcoming"),this.getTasks()}getTasks(){this.apiService.getTasks().pipe((0,b.K)(),(0,y.y)(t=>{this.taskList=t,this.columnList=this.sortTasksForUpcomingWeek(this.taskList)})).subscribe()}sortTasksForUpcomingWeek(t){const{start:n,end:a}=this.getUpcomingWeekRange(),i=Array.from({length:7}).map((c,l)=>{const f=new Date(n);return f.setDate(n.getDate()+l),f.toLocaleDateString("en-US",{weekday:"long"})}).map(c=>({title:c,tasks:[],events:[],habits:[]}));return t.forEach(c=>{let l=c.start_date||c.due_date;if(l&&(l=new Date(l),l>=n&&l<=a)){const f=l.toLocaleDateString("en-US",{weekday:"long"});i.find(g=>g.title===f)?.tasks.push(c)}}),i}getUpcomingWeekRange(){const t=new Date;t.setHours(0,0,0,0);const n=new Date(t);return n.setDate(t.getDate()+6),n.setHours(23,59,59,999),{start:t,end:n}}isDateWithinWeek(t,n,a){return t>=n&&t<=a}onTaskUpdate(t){this.apiService.updateTask(t).pipe((0,b.K)(),(0,y.y)(n=>{this.getTasks()})).subscribe()}static#t=this.\u0275fac=function(n){return new(n||e)(s.GI1(k),s.GI1(S.M$))};static#e=this.\u0275cmp=s.In1({type:e,selectors:[["xx-kanban-week-upcoming"]],decls:2,vars:1,consts:[[1,"flex","h-full"],["class","mr-3 w-[17.5rem]","aria-label","Column",4,"ngFor","ngForOf"],["aria-label","Column",1,"mr-3","w-[17.5rem]"],[3,"column","sortByPriority","onTaskUpdate"]],template:function(n,a){1&n&&(s.I0R(0,"div",0),s.yuY(1,pt,2,2,"div",1),s.C$Y()),2&n&&(s.yG2(),s.E7m("ngForOf",a.columnList))},dependencies:[T.ay,x.O]})}return e})();function gt(e,o){if(1&e){const t=s.KQA();s.I0R(0,"div",2)(1,"xx-column",3),s.qCj("onTaskUpdate",function(a){s.usT(t);const r=s.GaO();return s.CGJ(r.onTaskUpdate(a))}),s.C$Y()()}if(2&e){const t=o.$implicit;s.yG2(),s.E7m("column",t)}}let yt=(()=>{class e{constructor(t,n){this.apiService=t,this.pageTitleService=n,this.columnList=[],this.columnTitles=Object.values(p.WK).reverse(),this.taskList=[]}ngOnInit(){this.getTasks(),this.pageTitleService.setPageTitle("Kanban by Priority")}getTasks(){this.apiService.getTasks().pipe((0,b.K)(),(0,y.y)(t=>{this.taskList=this.filterOutChallengeTasks(t),this.columnList=this.sortTasksByPriorityAndStatus(this.taskList,this.columnTitles)})).subscribe()}filterOutChallengeTasks(t){return t.filter(n=>!n.challenge)}sortTasksByPriorityAndStatus(t,n){const a=n.map(r=>(0,M.m)(r));return t.forEach(r=>{const i=a.find(c=>c.title.toLowerCase()===r.priority);i&&i.tasks.push(r)}),a.forEach(r=>{r.tasks.sort((i,c)=>i.status.localeCompare(c.status))}),a}onTaskUpdate(t){this.getTasks()}static#t=this.\u0275fac=function(n){return new(n||e)(s.GI1(k),s.GI1(S.M$))};static#e=this.\u0275cmp=s.In1({type:e,selectors:[["xx-kanban-by-priority"]],decls:2,vars:1,consts:[[1,"flex","h-full"],["class","mr-3 w-[17.5rem]","aria-label","Column",4,"ngFor","ngForOf"],["aria-label","Column",1,"mr-3","w-[17.5rem]"],[3,"column","onTaskUpdate"]],template:function(n,a){1&n&&(s.I0R(0,"div",0),s.yuY(1,gt,2,1,"div",1),s.C$Y()),2&n&&(s.yG2(),s.E7m("ngForOf",a.columnList))},dependencies:[T.ay,x.O]})}return e})();var bt=m(6724);function Tt(e,o){if(1&e){const t=s.KQA();s.I0R(0,"div",2)(1,"xx-column",3),s.qCj("onTaskUpdate",function(a){s.usT(t);const r=s.GaO();return s.CGJ(r.onTaskUpdate(a))}),s.C$Y()()}if(2&e){const t=o.$implicit;s.yG2(),s.E7m("column",t)}}const kt=[{path:"",component:mt},{path:"week",component:ft},{path:"week-upcoming",component:ht},{path:"by-priority",component:yt},{path:"by-priority-2",component:(()=>{class e{constructor(t,n){this.apiService=t,this.pageTitleService=n,this.columnList=[],this.columnTitles=["First","Next","Soon","Planned","Draft","Done","Cancelled"],this.taskList=[]}ngOnInit(){this.getTasks(),this.pageTitleService.setPageTitle("Kanban by Priority 2")}getTasks(){this.apiService.getTasks().pipe((0,b.K)(),(0,y.y)(t=>{this.taskList=t.filter(n=>!n.challenge),this.columnList=this.sortTasksByPriority(this.taskList,this.columnTitles)})).subscribe()}sortTasksByPriority(t,n){const a=n.map(i=>(0,M.m)(i));return(0,bt.ek)(t,"asc").forEach(i=>{let c=this.mapStatusToColumnKey(i.status);if(c||(c=this.mapDueDateToColumnKey(i.due_date)),c){const l=a.find(f=>f.title===c);l&&l.tasks.push(i)}else{const l=a.find(g=>"First"===g.title),f=a.find(g=>"Next"===g.title),_=a.find(g=>"Soon"===g.title);l&&l.tasks.length<10?l.tasks.push(i):f&&f.tasks.length<10?f.tasks.push(i):_&&_.tasks.push(i)}}),a}mapStatusToColumnKey(t){return{[p.sD.Completed]:"Done",[p.sD.Cancelled]:"Cancelled",[p.sD.Draft]:"Draft"}[t]||null}mapDueDateToColumnKey(t){return t?this.categorizeDueDate(t):null}categorizeDueDate(t){return t?G(t)?"First":Q(t)?"Next":z(t,2,5)?"Soon":"Planned":null}onTaskUpdate(t){this.getTasks()}static#t=this.\u0275fac=function(n){return new(n||e)(s.GI1(k),s.GI1(S.M$))};static#e=this.\u0275cmp=s.In1({type:e,selectors:[["xx-kanban-by-priority-2"]],decls:2,vars:1,consts:[[1,"flex","h-full"],["class","mr-3 w-[17.5rem]","aria-label","Column",4,"ngFor","ngForOf"],["aria-label","Column",1,"mr-3","w-[17.5rem]"],[3,"column","onTaskUpdate"]],template:function(n,a){1&n&&(s.I0R(0,"div",0),s.yuY(1,Tt,2,1,"div",1),s.C$Y()),2&n&&(s.yG2(),s.E7m("ngForOf",a.columnList))},dependencies:[T.ay,x.O]})}return e})()},{path:"**",redirectTo:"/kanban",pathMatch:"full"}];let _t=(()=>{class e{static#t=this.\u0275fac=function(n){return new(n||e)};static#e=this.\u0275mod=s.a4G({type:e});static#n=this.\u0275inj=s.s3X({imports:[P.qQ.forChild(kt),P.qQ]})}return e})(),vt=(()=>{class e{static#t=this.\u0275fac=function(n){return new(n||e)};static#e=this.\u0275mod=s.a4G({type:e});static#n=this.\u0275inj=s.s3X({providers:[k,V.H],imports:[T.MD,_t,Z.k]})}return e})()}}]);